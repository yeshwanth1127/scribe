{
  "version": 3,
  "sources": ["../../@tauri-apps/plugin-updater/dist-js/index.js"],
  "sourcesContent": ["import { Resource, Channel, invoke } from '@tauri-apps/api/core';\r\n\r\n// Copyright 2019-2023 Tauri Programme within The Commons Conservancy\r\n// SPDX-License-Identifier: Apache-2.0\r\n// SPDX-License-Identifier: MIT\r\nclass Update extends Resource {\r\n    constructor(metadata) {\r\n        super(metadata.rid);\r\n        this.available = true;\r\n        this.currentVersion = metadata.currentVersion;\r\n        this.version = metadata.version;\r\n        this.date = metadata.date;\r\n        this.body = metadata.body;\r\n        this.rawJson = metadata.rawJson;\r\n    }\r\n    /** Download the updater package */\r\n    async download(onEvent, options) {\r\n        convertToRustHeaders(options);\r\n        const channel = new Channel();\r\n        if (onEvent) {\r\n            channel.onmessage = onEvent;\r\n        }\r\n        const downloadedBytesRid = await invoke('plugin:updater|download', {\r\n            onEvent: channel,\r\n            rid: this.rid,\r\n            ...options\r\n        });\r\n        this.downloadedBytes = new Resource(downloadedBytesRid);\r\n    }\r\n    /** Install downloaded updater package */\r\n    async install() {\r\n        if (!this.downloadedBytes) {\r\n            throw new Error('Update.install called before Update.download');\r\n        }\r\n        await invoke('plugin:updater|install', {\r\n            updateRid: this.rid,\r\n            bytesRid: this.downloadedBytes.rid\r\n        });\r\n        // Don't need to call close, we did it in rust side already\r\n        this.downloadedBytes = undefined;\r\n    }\r\n    /** Downloads the updater package and installs it */\r\n    async downloadAndInstall(onEvent, options) {\r\n        convertToRustHeaders(options);\r\n        const channel = new Channel();\r\n        if (onEvent) {\r\n            channel.onmessage = onEvent;\r\n        }\r\n        await invoke('plugin:updater|download_and_install', {\r\n            onEvent: channel,\r\n            rid: this.rid,\r\n            ...options\r\n        });\r\n    }\r\n    async close() {\r\n        await this.downloadedBytes?.close();\r\n        await super.close();\r\n    }\r\n}\r\n/** Check for updates, resolves to `null` if no updates are available */\r\nasync function check(options) {\r\n    convertToRustHeaders(options);\r\n    const metadata = await invoke('plugin:updater|check', {\r\n        ...options\r\n    });\r\n    return metadata ? new Update(metadata) : null;\r\n}\r\n/**\r\n * Converts the headers in options to be an {@linkcode Array<[string, string]>} which is what the Rust side expects\r\n */\r\nfunction convertToRustHeaders(options) {\r\n    if (options?.headers) {\r\n        options.headers = Array.from(new Headers(options.headers).entries());\r\n    }\r\n}\r\n\r\nexport { Update, check };\r\n"],
  "mappings": ";;;;;;;;AAKA,IAAM,SAAN,cAAqB,SAAS;AAAA,EAC1B,YAAY,UAAU;AAClB,UAAM,SAAS,GAAG;AAClB,SAAK,YAAY;AACjB,SAAK,iBAAiB,SAAS;AAC/B,SAAK,UAAU,SAAS;AACxB,SAAK,OAAO,SAAS;AACrB,SAAK,OAAO,SAAS;AACrB,SAAK,UAAU,SAAS;AAAA,EAC5B;AAAA;AAAA,EAEA,MAAM,SAAS,SAAS,SAAS;AAC7B,yBAAqB,OAAO;AAC5B,UAAM,UAAU,IAAI,QAAQ;AAC5B,QAAI,SAAS;AACT,cAAQ,YAAY;AAAA,IACxB;AACA,UAAM,qBAAqB,MAAM,OAAO,2BAA2B;AAAA,MAC/D,SAAS;AAAA,MACT,KAAK,KAAK;AAAA,MACV,GAAG;AAAA,IACP,CAAC;AACD,SAAK,kBAAkB,IAAI,SAAS,kBAAkB;AAAA,EAC1D;AAAA;AAAA,EAEA,MAAM,UAAU;AACZ,QAAI,CAAC,KAAK,iBAAiB;AACvB,YAAM,IAAI,MAAM,8CAA8C;AAAA,IAClE;AACA,UAAM,OAAO,0BAA0B;AAAA,MACnC,WAAW,KAAK;AAAA,MAChB,UAAU,KAAK,gBAAgB;AAAA,IACnC,CAAC;AAED,SAAK,kBAAkB;AAAA,EAC3B;AAAA;AAAA,EAEA,MAAM,mBAAmB,SAAS,SAAS;AACvC,yBAAqB,OAAO;AAC5B,UAAM,UAAU,IAAI,QAAQ;AAC5B,QAAI,SAAS;AACT,cAAQ,YAAY;AAAA,IACxB;AACA,UAAM,OAAO,uCAAuC;AAAA,MAChD,SAAS;AAAA,MACT,KAAK,KAAK;AAAA,MACV,GAAG;AAAA,IACP,CAAC;AAAA,EACL;AAAA,EACA,MAAM,QAAQ;AACV,UAAM,KAAK,iBAAiB,MAAM;AAClC,UAAM,MAAM,MAAM;AAAA,EACtB;AACJ;AAEA,eAAe,MAAM,SAAS;AAC1B,uBAAqB,OAAO;AAC5B,QAAM,WAAW,MAAM,OAAO,wBAAwB;AAAA,IAClD,GAAG;AAAA,EACP,CAAC;AACD,SAAO,WAAW,IAAI,OAAO,QAAQ,IAAI;AAC7C;AAIA,SAAS,qBAAqB,SAAS;AACnC,MAAI,SAAS,SAAS;AAClB,YAAQ,UAAU,MAAM,KAAK,IAAI,QAAQ,QAAQ,OAAO,EAAE,QAAQ,CAAC;AAAA,EACvE;AACJ;",
  "names": []
}
