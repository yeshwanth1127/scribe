{
  "version": 3,
  "sources": ["../../@tauri-apps/plugin-http/dist-js/index.js"],
  "sourcesContent": ["import { invoke, Channel } from '@tauri-apps/api/core';\r\n\r\n// Copyright 2019-2023 Tauri Programme within The Commons Conservancy\r\n// SPDX-License-Identifier: Apache-2.0\r\n// SPDX-License-Identifier: MIT\r\n/**\r\n * Make HTTP requests with the Rust backend.\r\n *\r\n * ## Security\r\n *\r\n * This API has a scope configuration that forces you to restrict the URLs that can be accessed using glob patterns.\r\n *\r\n * For instance, this scope configuration only allows making HTTP requests to all subdomains for `tauri.app` except for `https://private.tauri.app`:\r\n * ```json\r\n * {\r\n *   \"permissions\": [\r\n *     {\r\n *       \"identifier\": \"http:default\",\r\n *       \"allow\": [{ \"url\": \"https://*.tauri.app\" }],\r\n *       \"deny\": [{ \"url\": \"https://private.tauri.app\" }]\r\n *     }\r\n *   ]\r\n * }\r\n * ```\r\n * Trying to execute any API with a URL not configured on the scope results in a promise rejection due to denied access.\r\n *\r\n * @module\r\n */\r\nconst ERROR_REQUEST_CANCELLED = 'Request cancelled';\r\n/**\r\n * Fetch a resource from the network. It returns a `Promise` that resolves to the\r\n * `Response` to that `Request`, whether it is successful or not.\r\n *\r\n * @example\r\n * ```typescript\r\n * const response = await fetch(\"http://my.json.host/data.json\");\r\n * console.log(response.status);  // e.g. 200\r\n * console.log(response.statusText); // e.g. \"OK\"\r\n * const jsonData = await response.json();\r\n * ```\r\n *\r\n * @since 2.0.0\r\n */\r\nasync function fetch(input, init) {\r\n    // abort early here if needed\r\n    const signal = init?.signal;\r\n    if (signal?.aborted) {\r\n        throw new Error(ERROR_REQUEST_CANCELLED);\r\n    }\r\n    const maxRedirections = init?.maxRedirections;\r\n    const connectTimeout = init?.connectTimeout;\r\n    const proxy = init?.proxy;\r\n    const danger = init?.danger;\r\n    // Remove these fields before creating the request\r\n    if (init) {\r\n        delete init.maxRedirections;\r\n        delete init.connectTimeout;\r\n        delete init.proxy;\r\n        delete init.danger;\r\n    }\r\n    const headers = init?.headers\r\n        ? init.headers instanceof Headers\r\n            ? init.headers\r\n            : new Headers(init.headers)\r\n        : new Headers();\r\n    const req = new Request(input, init);\r\n    const buffer = await req.arrayBuffer();\r\n    const data = buffer.byteLength !== 0 ? Array.from(new Uint8Array(buffer)) : null;\r\n    // append new headers created by the browser `Request` implementation,\r\n    // if not already declared by the caller of this function\r\n    for (const [key, value] of req.headers) {\r\n        if (!headers.get(key)) {\r\n            headers.set(key, value);\r\n        }\r\n    }\r\n    const headersArray = headers instanceof Headers\r\n        ? Array.from(headers.entries())\r\n        : Array.isArray(headers)\r\n            ? headers\r\n            : Object.entries(headers);\r\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n    const mappedHeaders = headersArray.map(([name, val]) => [\r\n        name,\r\n        // we need to ensure we have all header values as strings\r\n        // eslint-disable-next-line\r\n        typeof val === 'string' ? val : val.toString()\r\n    ]);\r\n    // abort early here if needed\r\n    if (signal?.aborted) {\r\n        throw new Error(ERROR_REQUEST_CANCELLED);\r\n    }\r\n    const rid = await invoke('plugin:http|fetch', {\r\n        clientConfig: {\r\n            method: req.method,\r\n            url: req.url,\r\n            headers: mappedHeaders,\r\n            data,\r\n            maxRedirections,\r\n            connectTimeout,\r\n            proxy,\r\n            danger\r\n        }\r\n    });\r\n    const abort = () => invoke('plugin:http|fetch_cancel', { rid });\r\n    // abort early here if needed\r\n    if (signal?.aborted) {\r\n        // we don't care about the result of this proimse\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        abort();\r\n        throw new Error(ERROR_REQUEST_CANCELLED);\r\n    }\r\n    signal?.addEventListener('abort', () => void abort());\r\n    const { status, statusText, url, headers: responseHeaders, rid: responseRid } = await invoke('plugin:http|fetch_send', {\r\n        rid\r\n    });\r\n    // no body for 101, 103, 204, 205 and 304\r\n    // see https://fetch.spec.whatwg.org/#null-body-status\r\n    const body = [101, 103, 204, 205, 304].includes(status)\r\n        ? null\r\n        : new ReadableStream({\r\n            start: (controller) => {\r\n                const streamChannel = new Channel();\r\n                streamChannel.onmessage = (res) => {\r\n                    // close early if aborted\r\n                    if (signal?.aborted) {\r\n                        controller.error(ERROR_REQUEST_CANCELLED);\r\n                        return;\r\n                    }\r\n                    const resUint8 = new Uint8Array(res);\r\n                    const lastByte = resUint8[resUint8.byteLength - 1];\r\n                    const actualRes = resUint8.slice(0, resUint8.byteLength - 1);\r\n                    // close when the signal to close (last byte is 1) is sent from the IPC.\r\n                    if (lastByte == 1) {\r\n                        controller.close();\r\n                        return;\r\n                    }\r\n                    controller.enqueue(actualRes);\r\n                };\r\n                // run a non-blocking body stream fetch\r\n                invoke('plugin:http|fetch_read_body', {\r\n                    rid: responseRid,\r\n                    streamChannel\r\n                }).catch((e) => {\r\n                    controller.error(e);\r\n                });\r\n            }\r\n        });\r\n    const res = new Response(body, {\r\n        status,\r\n        statusText\r\n    });\r\n    // Set `Response` properties that are ignored by the\r\n    // constructor, like url and some headers\r\n    //\r\n    // Since url and headers are read only properties\r\n    // this is the only way to set them.\r\n    Object.defineProperty(res, 'url', { value: url });\r\n    Object.defineProperty(res, 'headers', {\r\n        value: new Headers(responseHeaders)\r\n    });\r\n    return res;\r\n}\r\n\r\nexport { fetch };\r\n"],
  "mappings": "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",
  "names": ["res"]
}
